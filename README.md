# 项目概述
 
- 本项目通过 AutoJS 在安卓设备上实现“按住说话 → 智谱语音转文字 → 大模型生成 JSON 指令 → 自动打开微信并发送消息”的完整流程
- 开发在电脑上进行，主脚本文件名为“语音到微信.js”，在手机上运行时通常命名为“main.js”
 
# 演示视频
 
- 抖音演示视频：2.33 09/13 LWz:/ X@z.tr 自制豆包手机，源码后面发github # 豆包手机 # DIY # 科技  
  `https://v.douyin.com/RKwxnREyiPA/`  
  复制此链接，打开抖音搜索，直接观看视频
 
- B站演示视频：【自制豆包手机，源码后面传github】  
  `https://www.bilibili.com/video/BV1wCkpBrEVu/?share_source=copy_web&vd_source=291c9312e603e0a0e8404aad147113c7`
 
# 功能特性
 
- 浮窗按钮：仅两个中等大小按钮（按住说话、退出），尽量减少遮挡并支持拖动
- 语音录制：优先 WAV 16k/单声道/16bit，失败时回退 AAC（m4a）或 3GP（amr_nb）
- 语音转写：调用智谱接口（glm-asr-2512）识别为中文文本
- 大模型调用：从系统提示词与识别文本构造上下文，请求 OpenRouter 等兼容接口，要求返回 JSON
- 自动发微信：根据模型返回 JSON 解析出联系人与消息内容，通过模板识别完成打开微信、搜索联系人、粘贴并发送
- 日志输出：将识别结果与模型完整 JSON 等关键步骤写入日志文件，并使用 log() 同步输出
 
# 目录结构
 
- 根目录  
  - REDEME.md（本说明文档）
  - 日志.log（运行日志）
  - 其他脚本与资源
- src/  
  - [config.json](file:///d:/D/a我自己写的程序/js/autojs/诺玛/src/config.json)（项目配置）
  - [系统提示词.txt](file:///d:/D/a我自己写的程序/js/autojs/诺玛/src/系统提示词.txt)（system 提示词）
  - [语音到微信.js](file:///d:/D/a我自己写的程序/js/autojs/诺玛/src/语音到微信.js)（主流程脚本）
  - 模型回复.json（可选：本地调试模型返回 JSON）
 
# 配置文件说明（src/config.json）
 
- apikey：大模型接口的 API Key（例如 OpenRouter）
- api：大模型 Chat Completions 接口地址
- model / model2：所使用的模型名称（优先读取 model2）
- zhipu_api_key：智谱 ASR 的密钥
- save_dir：录音保存目录（例如 /sdcard/诺玛/recordings）
 
注意：API Key 属于敏感信息，请勿泄露或提交到公开仓库
 
# 系统提示词（src/系统提示词.txt）
 
- 要求大模型严格返回 JSON，不包含额外文本
- 定义工具：sendWX，参数包含 tarName 与 message
- 可在该文件中扩展知识库与规则，以提高容错与指令准确性
 
# 运行步骤
 
- 将主脚本拷贝到手机上运行，并命名为 main.js（或按你的运行习惯）
- 保证 src 目录下的配置文件与系统提示词已准备好
- 准备以下模板图片（放在脚本运行目录）：  
  搜索图标.jpg、文字编辑.jpg、粘贴.jpg、发送图标.jpg、发送.jpg
- 授权无障碍、悬浮窗与截屏权限
- 运行脚本后，按住“按住说话”开始录音，松手即开始识别与请求模型，随后自动打开微信并发送消息
 
# 权限说明
 
- 悬浮窗：用于显示与操作浮窗按钮
- 无障碍：用于查找与点击屏幕元素（配合截图模板识别）
- 截屏权限：用于模板识别（images.findImage）
- 录音权限：用于语音采集并保存到本地
 
# 日志
 
- 文件：根目录下的 日志.log
- 必须日志：
  - 语音识别的内容（识别完成: <文本>）
  - 大模型返回的完整 JSON（模型HTTP响应、解析后JSON）
- 其他日志：打开微信、粘贴联系人/消息、执行指令、异常信息等
 
# 故障排查
 
- 浮窗消失：确保脚本常驻（主线程保活）、已授予悬浮窗权限
- 模板点击失败：检查浮窗位置是否遮挡，拖动至不影响识别区域；确保模板图片清晰并与当前界面匹配
- 识别失败：检查录音格式与权限，确保采样率与通道设置为 16k/mono/16bit 或使用回退编码
- 模型返回非 JSON：系统提示词需严格要求 JSON 返回；脚本会尝试抽取代码块或首个花括号 JSON
- 调试：可将模型输出写入 src/模型回复.json，脚本会读取并直接执行
 
# 免责声明
 
- 本项目仅供技术研究与学习使用，请遵守相关平台与应用的使用条款与法律法规
